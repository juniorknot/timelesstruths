!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return l.raw?e:encodeURIComponent(e)}function a(e){return l.raw?e:decodeURIComponent(e)}function i(e){return t(l.json?JSON.stringify(e):String(e))}function o(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(s," ")),l.json?JSON.parse(e):e}catch(t){}}function n(t,a){var i=l.raw?t:o(t);return e.isFunction(a)?a(i):i}var s=/\+/g,l=e.cookie=function(o,s,r){if(arguments.length>1&&!e.isFunction(s)){if("number"==typeof r&&(r={expires:r,path:"/"}),r=e.extend({},l.defaults,r),"number"==typeof r.expires){var d=r.expires,c=r.expires=new Date;c.setTime(+c+864e5*d)}return null===s?e.removeCookie(o,r):document.cookie=[t(o),"=",i(s),r.expires?"; expires="+r.expires.toUTCString():"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":""].join("")}for(var p=o?void 0:{},u=document.cookie?document.cookie.split("; "):[],h=0,f=u.length;f>h;h++){var m=u[h].split("="),v=a(m.shift()),$=m.join("=");if(o&&o===v){p=n($,s);break}o||void 0===($=n($))||(p[v]=$)}return p};l.defaults={},e.removeCookie=function(t,a){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},a,{expires:-1})),!e.cookie(t))}}),function(e){e.fn.jphandle=function(a){return a.axis="y"==a.axis?"y":"x",this.on("mousedown touchstart",function(a){var i=e(this).parents(".jp-handle-bar").addClass("jp-handle-dragging"),o=i.offset().left;t=void 0,e(window).on("mousemove.jphandle touchmove.jphandle",function(e){var t=e.pageX,a=o+i.width();o>t&&(t=o),t>a&&(t=a);var n=(t-o)/(a-o)*100;"undefined"!=typeof $JP&&$JP.jPlayer("playHead",n),e.preventDefault()}).one("mouseup touchend touchcancel",function(){e(this).off("mousemove.jphandle touchmove.jphandle click.jphandle"),i.removeClass("jp-handle-dragging"),e(".jp-handle").focus()}),a.preventDefault()}),this}}(jQuery);var TT=TT||{};TT.Utility={initTranslate:function(){$("#btn_translate").on("click",function(){$el=$("#translate"),$el.hasClass("init")||($.getScript("http://translate.google.com/translate_a/element.js?cb=TT.Utility.initGoogleTranslate"),$el.addClass("init")),$(this).hide(),$el.toggleClass("open"),ga("send","event","Translate",$el.hasClass("open")?"show":"hide")})},initGoogleTranslate:function(){new google.translate.TranslateElement({pageLanguage:"en"},"google_translate")},initTOC:function(){$(".toc .collapsible").each(function(){var e=$(this).attr("id");"open"!=$.cookie("t_"+e)&&$(this).addClass("min")}).on("click",function(){var e=$(this).attr("id");return $(this).toggleClass("min"),$.cookie("t_"+e,$(this).hasClass("min")?null:"open",{expires:1/24/12}),!1})},initNotes:function(){$(".page .note-ref").on("click",function(){return $el=$($(this).attr("href")),$el.css("top",$(this).position().top),$el.toggle(),(b=+$el.css("bottom").replace("px",""))<0&&$el.css("top",$el.position().top+b),!1}),$(".page .note-num").on("click",function(){$(this).parents(".note").hide()})},trackLink:function(e,t,a){try{ga("send","event",t,a),setTimeout('window.location = "'+e.href+'"',100)}catch(i){}return!1}},TT.Music={format:"pdf"==$.cookie("m_score_format")?"pdf":"sib",zoom:$.cookie("m_score_zoom")||760,notes:"+"==$.cookie("m_score_notes")?"shaped":"standard",init:function(){this.initScore()},initScore:function(){$("#score-format").on("click",function(){TT.Music.setScore("format",$(this).val())}),$("#score-notes").on("click",function(){TT.Music.setScore("notes",$(this).val())}),$("#score-zoom").on("click",function(){TT.Music.setZoom($(this).val())}),$(".help-link .show, .help-link .hide").on("click",function(){return $el=$(this).parents(".panel-toggle"),$el.toggleClass("hide"),ga("send","event","Score",($el.hasClass("hide")?"hide":"show")+" help"),!1})},setZoom:function(e){if(this.zoom!=e){this.zoom=e,$.cookie("m_score_zoom",this.zoom,1e3);var t=this.zoom,a=1.3*t+26;$("#score").width(t).height(a)}},setScore:function(e,t){var a=$('[name="'+e+'"]').attr("data-default");if("format"==e){if(this.format==t)return;this.format=t,$.cookie("m_score_format",this.format!=a?this.format:null,1e3)}if("notes"==e){if(this.notes==t)return;this.notes=t,$.cookie("m_score_notes","shaped"==this.notes?"+":null,1e3)}var i="data-src-"+this.format+"-"+this.notes,o=$("#score"),n=o.attr(i);if(n)o.html('<div class="wrapper">'+("pdf"==this.format?'<iframe id="s_pdf" frameborder="0" src="'+n+'"></iframe>':"")+("sib"==this.format?'<object id="s_sib" type="application/x-sibelius-score" data="'+n+'"><param name="src" value="'+n+'" /><param name="scorch_minimum_version" value="3000" /><param name="scorch_shrink_limit" value="100" /><param name="shrinkwindow" value="0" /></object>':"")+"</div>");else{var s=encodeURI("Request: "+$("title").text().replace(/ >.+/,"")+" (."+this.format+")"),l=encodeURI("I would like to have the ."+this.format+" sheet music for this song added to your priority list. Thank you."),r=encodeURI(window.location.href);o.html('<div class="wrapper"><div class="error-message"><p>Sorry, the sheet music is not available in this format (.'+TT.Music.format+'):</p><ul><li><a class="blue" href="'+$("body").attr("data-level")+"contact/?subject="+s+"&amp;comments="+l+"&amp;url="+r+'">Request sheet music</a></li></ul></div></div>')}}},TT.Player={selector:".use-player",ready:!1,visible:!1,href:"",quality:"low"==$.cookie("t_audio_quality")?"low":"standard",jp_options:{swfPath:$("#jp").attr("data-swfpath"),cssSelectorAncestor:"#player",wmode:"window",remainingDuration:!0,toggleDuration:!0,autoBlur:!1,ready:function(){$(TT.Player.selector).click(function(){return TT.Player.toggle($(this).attr("href")),!1}),$(".jp-handle").keyup(function(e){var t=$JP.data("jPlayer").status.currentPercentAbsolute;"ArrowLeft"==e.key&&$JP.jPlayer("playHead",t-5),"ArrowRight"!=e.key&&" "!=e.key||$JP.jPlayer("playHead",t+5),"Enter"==e.key&&(TT.Player.toggle(),e.preventDefault()),console.log(e.key,$JP.data("jPlayer").status)}),$(".jp-play").on("click keypress",function(e){"click"!=e.type&&"Enter"!=e.key||(TT.Player.toggle(),e.preventDefault()),console.log("jp-play",$JP.data("jPlayer"))}),$("#player").addClass("jp-ready")},error:function(e){var t=e.jPlayer.error;$(".jp-error").addClass("show").html('<p class="msg">'+t.message+'</p><p class="context">('+t.context+")</p>"),console.log("error",e.jPlayer.error,e)},progress:function(e){console.log("progress",e.jPlayer.status.seekPercent)},timeupdate:function(){},play:function(){$('[data-state="paused"]').attr("data-state","playing")},pause:function(){$('[data-state="playing"]').attr("data-state","paused")},ended:function(){$('[data-state="playing"]').attr("data-state","paused")},canplay:function(){$(".jp-error").removeClass("show").html("")}},init:function(){$(".use-player").length&&($("body").append('<div id="jp" data-swfpath="https://cdn.jsdelivr.net/jplayer/2.9.2/"></div><div id="player">  <div class="jp-gui">    <ul class="jp-controls">      <li class="jp-control jp-play"><button class="jp-btn" title="play" aria-label="play" tabindex="2">        <svg class="icon-play" width="24" viewBox="0 0 20 20"><path d="M4,0 l 16,10 -16,10 z"></svg>        <svg class="icon-pause" width="24" viewBox="0 0 20 20"><path d="M2,0 h6 v20 h-6 v-20 z M12,0 h6 v20 h-6 v-20 z"></svg>      </button></li>      <li class="jp-control jp-quality"><label>Quality: </label><select tabindex="3">        <option value="standard">standard</option>        <option value="low">dial-up</option>      </select></li>      <li class="jp-control jp-download"><a href="#download" class="jp-btn" title="download" tabindex="4">        <svg class="icon-download" width="16" viewBox="0 0 16 16"><path d="M5,1 h6 v5 h3 l-6,6 -6,-6 h3 z M2,13 h12 v2 h-12 z"></svg>      </a></li>    </ul>    <div class="jp-progress">      <div class="jp-seek-bar jp-handle-bar">        <div class="jp-play-bar">          <a href="#handle" class="jp-handle" tabindex="1"></a>        </div>      </div>    </div>    <div class="jp-time">      <div class="jp-current-time" aria-label="time" role="timer"></div>      <div class="jp-duration" aria-label="duration" role="timer" title="toggle total/remaining time"></div>    </div>  </div><!--/.jp-gui-->  <div class="jp-error"></div>  <div class="jp-no-solution">    <span>Update Required</span>    To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.  </div><!--/.jp-no-solution--></div><!--/#player-->'),$(".jp-handle").jphandle({axis:"x"}),$(".jp-control select").val(this.quality).on("change",function(){TT.Player.set("quality",$(this).val())}),$JP=$("#jp").jPlayer(TT.Player.jp_options),(href=$.cookie("player-load-href"))&&this.load(href))},"do":function(e){$JP.jPlayer(e)},show:function(){this.visible=!0,$("html").addClass("player-visible")},load:function(e){e&&e!=this.href&&(this.show(),this.href=e,$(".jp-download [href]").attr("href",this.href),$("#player").attr("data-href",this.href),$JP.jPlayer("setMedia",{mp3:this.href}))},toggle:function(e){this.load(e);var t=$JP.data("jPlayer").status.paused;this["do"](t?"play":"pause"),$(".jp-play .jp-btn").attr("title",t?"pause":"play").attr("aria-label",t?"pause":"play"),$('[href="'+this.href+'"]').toggleClass("is-playing",t),console.log("toggle",!t)},set:function(e,t){"quality"==e&&$.cookie("t_audio_quality","low"==t?"low":null,1e3)}},TT.Admin={init:function(){$("html").addClass("admin"),this.initEditable()},initEditable:function(){$("[data-editable]").append('<a class="edit" title="edit" href="#edit"></a>'),$("[data-editable]").on("click",".edit",function(){return"loaded"==$(this).parents("[data-editable]").attr("data-status")?!1:(TT.Admin.edit($(this).parent(),"get",function(e){$('[data-editable="'+e.edit+'"]').data("originalValue",e.value).attr("data-status","loaded").find(".edit").before("<textarea>"+e.value+"</textarea>"),console.log("get",e)}),!1)}),$("[data-editable]").on("change","textarea",function(){var e="true",t=$(this).val(),a=new DOMParser,i=a.parseFromString("<xml>"+t+"</xml>","text/xml");"parsererror"==i.documentElement.nodeName&&(e="invalid"),$(this).attr("data-modified",e)}),$("[data-editable]").on("click","[data-modified] + .edit",function(){TT.Admin.edit($(this).parent(),"set",function(e){console.log("set",e),window.location.reload()})})},edit:function(e,t,a){var i=e.attr("data-editable"),o="http://localhost/admin.timelesstruths.org/Editable",n={view:!1,action:t,edit:i};if("set"==t){var e=e.find("textarea");if("invalid"==e.attr("data-modified"))return!1;n.value=escape(e.val())}$.get(o,n,a,"json")}},TT.Dev={init:function(){$("body").append("<div id='dev'>Dev | <button data-opt='exit'>exit</button></dev>"),$('#dev [data-opt="exit"]').click(function(){$.cookie("dev",!1,{path:"/"}),window.location.reload()})}},$(function(){TT.Utility.initNotes(),TT.Player.init(),"localhost"==window.location.hostname&&TT.Admin.init(),$("html").hasClass("dev")&&TT.Dev.init()});